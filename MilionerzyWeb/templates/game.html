<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYSTEM_GAME_MODULE</title>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root {
            --neon-blue: #00f3ff;
            --neon-pink: #ff0055;
            --neon-green: #0aff00;
            --bg-dark: #050510;
        }

        body {
            margin: 0; padding: 20px;
            background-color: var(--bg-dark);
            color: white;
            font-family: 'Exo 2', sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
        }

        /* --- T≈ÅO (Siatka + CzƒÖsteczki) --- */
        #particles-js { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; }
        .cyber-grid {
            position: fixed; top: 0; left: 0; width: 200%; height: 200%;
            background-image: linear-gradient(var(--neon-blue) 1px, transparent 1px),
            linear-gradient(90deg, var(--neon-blue) 1px, transparent 1px);
            background-size: 50px 50px; opacity: 0.05;
            transform: perspective(500px) rotateX(60deg);
            animation: gridMove 20s linear infinite; z-index: -1; pointer-events: none;
        }
        @keyframes gridMove { 0% { transform: perspective(500px) rotateX(60deg) translateY(0); } 100% { transform: perspective(500px) rotateX(60deg) translateY(50px); } }

        /* --- HUD TOP BAR --- */
        .top-bar {
            width: 100%; max-width: 900px;
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(0, 20, 40, 0.7);
            border: 1px solid var(--neon-blue);
            padding: 15px 25px;
            border-radius: 5px;
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.15);
            backdrop-filter: blur(5px);
            margin-bottom: 20px;
            position: relative;
        }
        /* Dekoracyjne linie HUD */
        .top-bar::before { content: ''; position: absolute; top: 0; left: 30%; width: 40%; height: 2px; background: var(--neon-blue); box-shadow: 0 0 10px var(--neon-blue); }

        .btn-exit {
            background: transparent; border: 1px solid var(--neon-pink); color: var(--neon-pink);
            padding: 8px 20px; font-family: 'Share Tech Mono', monospace; cursor: pointer;
            transition: 0.3s; text-transform: uppercase; letter-spacing: 2px;
        }
        .btn-exit:hover { background: var(--neon-pink); color: white; box-shadow: 0 0 15px var(--neon-pink); }

        .money-display {
            font-family: 'Share Tech Mono', monospace; font-size: 1.8rem; color: #ffd700;
            text-shadow: 0 0 10px #ffd700;
        }

        /* --- PASEK POSTƒòPU --- */
        .progress-container {
            width: 100%; max-width: 900px; height: 4px; background: #222; margin-bottom: 30px; position: relative;
        }
        .progress-bar {
            height: 100%; background: var(--neon-blue); width: 0%;
            box-shadow: 0 0 10px var(--neon-blue); transition: width 0.5s;
            position: relative;
        }
        .progress-bar::after { content: ''; position: absolute; right: 0; top: -3px; width: 10px; height: 10px; background: white; border-radius: 50%; box-shadow: 0 0 15px white; }

        /* --- PYTANIE --- */
        .question-box {
            width: 100%; max-width: 900px;
            background: rgba(0, 0, 0, 0.6);
            border-left: 5px solid var(--neon-blue);
            border-right: 5px solid var(--neon-blue);
            padding: 40px; text-align: center;
            font-size: 1.5rem; line-height: 1.5;
            margin-bottom: 40px; position: relative;
            box-shadow: inset 0 0 30px rgba(0, 243, 255, 0.1);
        }
        .question-box::after {
            content: "INCOMING DATA STREAM...";
            position: absolute; top: -25px; left: 0;
            font-family: 'Share Tech Mono', monospace; font-size: 0.8rem; color: var(--neon-blue);
        }

        /* --- ODPOWIEDZI --- */
        .answers-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 20px;
            width: 100%; max-width: 900px;
        }
        @media (max-width: 700px) { .answers-grid { grid-template-columns: 1fr; } }

        .answer-btn {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 20px; font-size: 1.2rem; color: #ccc;
            cursor: pointer; position: relative; overflow: hidden;
            transition: 0.3s; font-family: 'Exo 2', sans-serif;
            clip-path: polygon(20px 0, 100% 0, 100% calc(100% - 20px), calc(100% - 20px) 100%, 0 100%, 0 20px);
        }
        .answer-btn:hover {
            background: rgba(0, 243, 255, 0.1); border-color: var(--neon-blue);
            color: white; text-shadow: 0 0 5px var(--neon-blue);
            transform: scale(1.02);
        }
        
        .answer-btn.correct { background: rgba(10, 255, 0, 0.2) !important; border-color: var(--neon-green) !important; color: var(--neon-green) !important; box-shadow: 0 0 20px var(--neon-green); }
        .answer-btn.wrong { background: rgba(255, 0, 85, 0.2) !important; border-color: var(--neon-pink) !important; color: var(--neon-pink) !important; box-shadow: 0 0 20px var(--neon-pink); }
        .answer-btn.disabled { opacity: 0.3; pointer-events: none; }

        /* --- LIFELINES --- */
        .lifelines { display: flex; gap: 20px; margin-bottom: 30px; }
        .lifeline {
            width: 60px; height: 60px; border-radius: 50%;
            background: transparent; border: 2px solid var(--neon-blue); color: var(--neon-blue);
            font-size: 1.2rem; cursor: pointer; transition: 0.3s;
            display: flex; align-items: center; justify-content: center;
        }
        .lifeline:hover { background: var(--neon-blue); color: black; box-shadow: 0 0 20px var(--neon-blue); transform: rotate(15deg); }
        .lifeline:disabled { border-color: #333; color: #333; cursor: not-allowed; box-shadow: none; transform: none; }

        /* --- MODAL --- */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9); z-index: 100; backdrop-filter: blur(5px);
            align-items: center; justify-content: center;
        }
        .modal-content {
            background: #050510; border: 2px solid var(--neon-blue); padding: 40px;
            max-width: 600px; width: 90%; text-align: center;
            box-shadow: 0 0 50px rgba(0, 243, 255, 0.2);
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .modal-icon { font-size: 4rem; margin-bottom: 20px; }
        .btn-next {
            background: var(--neon-green); color: black; border: none; padding: 15px 40px;
            font-size: 1.2rem; font-weight: bold; cursor: pointer; font-family: 'Exo 2', sans-serif;
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
        }
        .btn-next:hover { box-shadow: 0 0 20px var(--neon-green); }

    </style>
</head>
<body>

    <div class="cyber-grid"></div>
    <div id="particles-js"></div>

    <div class="top-bar">
        <button class="btn-exit" onclick="confirmExit()"><i class="fas fa-power-off"></i> ABORT</button>
        <div class="money-display">{{ money }} PLN</div>
    </div>

    <div class="progress-container">
        <div class="progress-bar" style="width: {{ (q_num / 12) * 100 }}%;"></div>
    </div>

    <div class="lifelines">
        <button class="lifeline" title="50:50" onclick="useLifeline('5050', this)" {% if not lifelines['5050'] %}disabled{% endif %}>50</button>
        <button class="lifeline" title="Telefon" onclick="useLifeline('phone', this)" {% if not lifelines['phone'] %}disabled{% endif %}><i class="fas fa-phone-alt"></i></button>
        <button class="lifeline" title="Publiczno≈õƒá" onclick="useLifeline('audience', this)" {% if not lifelines['audience'] %}disabled{% endif %}><i class="fas fa-users"></i></button>
    </div>

    <div class="question-box">
        {{ question }}
    </div>

    <div class="answers-grid">
        {% for opt in options %}
        <button class="answer-btn" data-answer="{{ opt }}" onclick="checkAnswer(this)">{{ opt }}</button>
        {% endfor %}
    </div>

    <div id="infoModal" class="modal">
        <div class="modal-content" id="modalContent">
            <div id="modalIcon" class="modal-icon"></div>
            <h2 id="modalTitle" style="font-family: 'Share Tech Mono'; letter-spacing: 2px;"></h2>
            <p id="modalText" style="font-size: 1.2rem; color: #ddd; line-height: 1.6; margin-bottom: 30px;"></p>
            <button id="btnNext" class="btn-next">KONTYNUUJ >></button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script>
        particlesJS("particles-js", { "particles": { "number": { "value": 50 }, "color": { "value": "#ffffff" }, "opacity": { "value": 0.1 }, "size": { "value": 2 }, "line_linked": { "enable": false }, "move": { "speed": 1 } } });

        function confirmExit() { if(confirm("Czy przerwaƒá misjƒô?")) location.href="/"; }

        function checkAnswer(btn) {
            let answer = btn.getAttribute('data-answer');
            document.querySelectorAll('.answer-btn').forEach(b => b.classList.add('disabled'));

            fetch('/check', {
                method: 'POST',
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                body: 'answer=' + encodeURIComponent(answer)
            })
            .then(r => r.json())
            .then(data => {
                let modal = document.getElementById('infoModal');
                let title = document.getElementById('modalTitle');
                let text = document.getElementById('modalText');
                let nextBtn = document.getElementById('btnNext');
                let icon = document.getElementById('modalIcon');
                let content = document.getElementById('modalContent');

                setTimeout(() => { modal.style.display = 'flex'; }, 800);

                text.innerHTML = data.info || "Brak danych w bazie.";

                if (data.status === 'ok' || data.status === 'win') {
                    btn.classList.add('correct');
                    title.innerText = "ACCESS GRANTED";
                    title.style.color = "#0aff00";
                    content.style.borderColor = "#0aff00";
                    icon.innerHTML = '<i class="fas fa-check-circle" style="color:#0aff00"></i>';
                    
                    if (data.status === 'win') {
                        nextBtn.innerText = "ODBIERZ NAGRODƒò";
                        nextBtn.onclick = () => location.href = data.redirect;
                    } else {
                        nextBtn.innerText = "NASTƒòPNY POZIOM";
                        nextBtn.onclick = () => location.reload();
                    }
                } else {
                    btn.classList.add('wrong');
                    title.innerText = "ACCESS DENIED";
                    title.style.color = "#ff0055";
                    content.style.borderColor = "#ff0055";
                    icon.innerHTML = '<i class="fas fa-times-circle" style="color:#ff0055"></i>';
                    text.innerHTML = "Wymagana odpowied≈∫: <b style='color:#0aff00'>" + data.correct + "</b><br><br>" + (data.info || "");
                    
                    nextBtn.innerText = "RAPORT MISJI";
                    nextBtn.onclick = () => location.href = data.redirect;
                    nextBtn.style.background = "#ff0055";
                }
            });
        }

        function useLifeline(type, btn) {
            btn.disabled = true;
            fetch('/lifeline/' + type).then(r => r.json()).then(data => {
                if(data.status === 'used') return;
                if(type === '5050') {
                    document.querySelectorAll('.answer-btn').forEach(b => {
                        if(data.remove.includes(b.getAttribute('data-answer'))) {
                            b.innerText = "---"; b.classList.add('disabled'); b.style.opacity = 0.2;
                        }
                    });
                } else if(type === 'phone') alert("üì° PO≈ÅƒÑCZENIE PRZYCHODZƒÑCE:\n" + data.msg);
                else if(type === 'audience') {
                    let msg = "üìä DANE STATYSTYCZNE:\n";
                    for(const [k, v] of Object.entries(data.stats)) msg += k + ": " + v + "%\n";
                    alert(msg);
                }
            });
        }
    </script>
</body>
</html>